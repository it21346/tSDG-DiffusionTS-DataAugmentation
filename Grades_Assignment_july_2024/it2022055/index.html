<html>
    <head>
        <title>Book DataBase</title>
        <link rel="stylesheet" type="text/css" href="index.css">
    </head>
    <body>
        <h1>Book Managment</h1>
        <h2>New book registration:</h2>
        <form id="BookRegistration"> <!--Form for the book registration-->
            <p></p>
            <div class="input-field">
                <input id="author" required="" name="author" type="text" /> <!--Textbox creation-->
                <label for="author">Author:</label> <!--Label for Author-->
              </div>
            <p></p>
            <div class="input-field">
                <input id="title" required="" name="title" type="text" /> <!--Textbox creation-->
                <label for="title">Title:</label> <!--Label for Title-->
              </div>
            <p></p>
            <div class="select-field">
                <select id="genre" name="genre" required>
                    <option value="" disabled selected hidden></option>
                    <option value="Science fiction">Science fiction</option>
                    <option value="Satire">Satire</option>
                    <option value="Drama">Drama</option>
                    <option value="Action and Adventure">Action and Adventure</option>
                    <option value="Romance">Romance</option>
                    <option value="Mystery">Mystery</option>
                    <option value="Horror">Horror</option>
                </select>
                <label for="genre">Genre:</label>
            </div>           
            <p></p>
            <div class="input-field">
                <input id="price" required="" name="price" type="text" /> <!--Textbox creation-->
                <label for="price">Price:</label> <!--Label for Price-->
              </div>
            <p></p>
            <button id="Registerbutton" type="submit">Register</button> <!--Button creation-->
        </form>
        <h2>Search Book by Keyword:</h2>
        <form id="Booksearch"> <!--Form for book search-->
            <p></p>
            <div class="input-field">
                <input id="booksearch" required="" name="Search" type="text" /> <!--Textbox creation-->
                <label for="Booksearch">Book search:</label> <!--Label for Book search-->
            </div>
            <p></p>
            <input type="submit" value="Search"/> <!--Button creation-->
        </form>
        <div id="results" style="color: #000; padding-bottom: 50px;"></div> <!--Div for showing the books from search-->
        <script>
            document.getElementById("BookRegistration").addEventListener("submit", function(event) {
                event.preventDefault();
                let author=document.getElementById("author").value;
                let title=document.getElementById("title").value;
                let genre=document.getElementById("genre").value;
                let price=document.getElementById("price").value;
    
                if(isNaN(price) || parseFloat(price) <= 0) { //Price input check
                    alert("Please enter a valid number");
                    return;
                }
        
                let BookInfo= { //Variable containing book info
                    author : author,
                    title : title,
                    genre : genre,
                    price : parseFloat(price)
                };
                    fetch('http://localhost:3000/books/', { //Try to reach the server
                        method:'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(BookInfo) //Json containing the book information
                    })
                    .then(response => { //if server response is ok
                        if (response.ok) {
                            console.log("Book registered successfully");
                            alert("Book registered successfully");
                        } else { //If not throw error
                            throw new Error('Network response was not ok');
                            alert("Book could not be registered");
                        }
                        })
                        .catch(error => { //If there was an error in the process
                            console.error('There was a problem with the fetch operation:', error);
                        });
            });
            document.getElementById("Booksearch").addEventListener("submit",function(event) {
                event.preventDefault();
                let keyword=document.getElementById("booksearch").value;
                let resultsDiv=document.getElementById("results");
                resultsDiv.innerHTML = ""; // Clear previous results
            fetch(`http://localhost:3000/books/${keyword}`, { //Trying to access the server
                method: 'GET',
            })
            .then(response => { //If server response is ok, the status will be 200
                if (response.status===200) {
                    return response.json();
                } else { //If not throw error
                    throw new Error('Network response was not ok');
                }   
            })
            .then(data => { //For the data recieved
                if (data.length > 0) { 
                    data.forEach(book => { //For eatch book
                    let bookDiv=document.createElement("div");
                    let bookid=document.createElement("strong");
                    bookid.textContent="Id: ";
                    let Bookidvalue=document.createElement("span");
                    Bookidvalue.textContent=book.id;
                    bookDiv.appendChild(bookid);
                    bookDiv.appendChild(Bookidvalue);
                    bookDiv.appendChild(document.createElement("br"));
                    let title=document.createElement("strong");
                    title.textContent="Title: ";
                    let titleValue=document.createElement("span");
                    titleValue.textContent=book.title;
                    bookDiv.appendChild(title);
                    bookDiv.appendChild(titleValue);
                    bookDiv.appendChild(document.createElement("br"));
                    let author=document.createElement("strong");
                    author.textContent="Author: ";
                    let authorValue=document.createElement("span");
                    authorValue.textContent=book.author;
                    bookDiv.appendChild(author);
                    bookDiv.appendChild(authorValue);
                    bookDiv.appendChild(document.createElement("br"));
                    let genre=document.createElement("strong");
                    genre.textContent="Genre: ";
                    let genreValue=document.createElement("span");
                    genreValue.textContent = book.genre;
                    bookDiv.appendChild(genre);
                    bookDiv.appendChild(genreValue);
                    bookDiv.appendChild(document.createElement("br"));
                    let price=document.createElement("strong");
                    price.textContent="Price: ";
                    let priceValue=document.createElement("span");
                    priceValue.textContent = book.price;
                    bookDiv.appendChild(price);
                    bookDiv.appendChild(priceValue);
                    bookDiv.appendChild(document.createElement("br"));
                    resultsDiv.appendChild(bookDiv);
                });
                } else { //If no data were recieved
                    let messageDiv=document.createElement("div");
                    messageDiv.textContent="No books were found";
                    resultsDiv.appendChild(messageDiv);
                }
            })
            .catch(error => { //If there was an error in the process
                console.error('There was a problem with the fetch operation:', error);
            });
            });
        </script>
    </body>
</html>