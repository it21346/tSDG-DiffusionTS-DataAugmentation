<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Books</title>
        <style>

            .book-search{
                margin-top: 100px;
                margin-left: 60px;
            }      
            
            .book-insert{
                margin-top: 70px;
                margin-left: 60px;
            }   

            body {
                background-image: url(' https://americanbookco.com/wp-content/uploads/2021/02/stacked-books-1920x960.jpeg');
                background-attachment: fixed;  
                background-size: 100% 100%;
                background-size: cover;
            }

            .error-message{
                color: red;
                margin-top: 10px;
            }

           .success-message{
                color: green;
                margin-top: 10px;
            }

            .warning {
                color: red;
                display: none; 
            }

            .no-results {
                width: 100%;
                text-align: center;

            }

            .title-results {
                width: 100%;
                text-align: center;
            }

            .books-container{
                margin-left: 60px;
                margin-top: 50px;
                display: flex;
                flex-direction: row;
                justify-content: center;
                align-items: center;
                column-gap: 20px;
            }

        </style>
        
    </head>
    <body>
        
        <div class="book-search">
            <h1> Search for a book </h1>
            <input type="text" id="search" placeholder="Search by title" class="searchbar-search">            
            <button id="search-button" class="button-search" >Search</button>
            <p class="warning" id="search-warning">Please fill the search bar</p>
        </div>

        <div id="books-container" class="books-container"></div>


        <div class="book-insert">
            <h1> Insert a book </h1>

            <label for="author">Author:</label>
            <input type="text" id="author" placeholder="Author">
            <p></p>
            <label for="title">Title:</label>
            <input type="text" id="title" placeholder="Title">
            <p></p>
            <label for="genre">Choose a genre:</label>
            <select name="genre" id="genre" placeholder="Genre">
                <option value="Science fiction">Science fiction</option>
                <option value="Satire">Satire</option>
                <option value="Drama">Drama</option>
                <option value="Action and Adventure">Action and Adventure</option>
                <option value="Romance">Romance</option>
                <option value="Mystery">Mystery</option>
                <option value="Horror">Horror</option>
            </select>
            <p></p>
            <label for="price">Price:</label>
            <input type="text" id="price" placeholder="Price">
            <p></p>
            <input type="button" id="send_request" value ="Send Request!">
            <p id="error-message" class="error-message"></p>
            <p id="success-message" class="success-message"></p>
        </div>


    </body>
    <script type="text/javascript">

        class Book {
            constructor(author, title, genre, price) {
                this.author = author;
                this.title = title;
                this.genre = genre;
                this.price = price;
            }
        }

        const booksContainer = document.getElementById('books-container');
        document.getElementById('search-button').addEventListener('click', async (e) => {
            const searchBook = document.getElementById('search').value;
            const warning = document.getElementById('search-warning');
    
            if (searchBook.trim() === "") {
                warning.style.display = "block";

            } else{

            warning.style.display = "none";

            const url = 'http://localhost:3000/books/' + searchBook;
            const response = await fetch(url);
            const data = await response.json();

            booksContainer.innerHTML = ''; 
                 
                // Display the container
                booksContainer.style.display = "flex";
                booksContainer.style.flexWrap = "wrap";
                const titleElem = document.createElement('h2');
                titleElem.classList.add('title-results');
                titleElem.textContent = 'Results';
                booksContainer.appendChild(titleElem);

             // Display the search results
             if (data.length === 0) {
                    const noRes = document.createElement('h2');
                   // noRes.style.textAlign = 'center';
                   noRes.classList.add('no-results')
                    noRes.textContent = 'No results';
                    titleElem.style.display = "none";
                booksContainer.appendChild(noRes);
                } else {
                data.forEach(book => {
                    const bookDiv = document.createElement('div');
                    bookDiv.style.backgroundColor = 'white';
                    bookDiv.style.borderRadius = '20px';
                    bookDiv.style.paddingLeft = '10px';
                    bookDiv.style.paddingRight = '10px';
                    const titleElem = document.createElement('p');
                    const idElem = document.createElement('p');
                    const authorElem = document.createElement('p');
                    const genreElem = document.createElement('p');
                    const priceElem = document.createElement('p');

                    titleElem.textContent = book.title;
                    idElem.textContent = 'ID: ' + book.id;
                    authorElem.textContent = 'Author: ' + book.author;
                    genreElem.textContent = 'Genre: ' + book.genre;
                    priceElem.textContent = 'Price: ' + book.price;
            
                    bookDiv.appendChild(titleElem);
                    bookDiv.appendChild(idElem);
                    bookDiv.appendChild(authorElem);
                    bookDiv.appendChild(genreElem);
                    bookDiv.appendChild(priceElem);
                    bookDiv.classList.add('book');
                    booksContainer.appendChild(bookDiv);
                    });
                }
            }
        });
        
        document.getElementById('send_request').addEventListener('click',async (e)=>{

            const author = document.getElementById('author').value;
            const title = document.getElementById('title').value;
            const genre = document.getElementById('genre').value;
            const price = document.getElementById('price').value;

            if (!validateInputs(author, title, genre, price)) {
                
                return;
            }

            const book = new Book(author, title, genre, price);

            const url = 'http://localhost:3000/books';
            const result = await fetch(url,{
                method:'POST',
                headers: {
                    "Content-Type":"application/json"
                },
                body: JSON.stringify(book)
            });
            console.log(result.json());
        });

        function validateInputs(author, title, genre, price) {
            const errorMessage = document.getElementById('error-message');
            errorMessage.textContent = '';
            const successMessage = document.getElementById('success-message');
            successMessage.textContent = '';

            if (!author) {
                errorMessage.textContent = 'Author is required.';
                return false;
            }

            if (!title) {
                errorMessage.textContent = 'Title is required.';
                return false;
            }

            if (!genre) {
                errorMessage.textContent = 'Genre is required.';
                return false;
            }

            if (!price) {
                errorMessage.textContent = 'Price is required.';
                return false;
            }

            if (isNaN(price)) {
                errorMessage.textContent = 'Price must be a valid number.';

                return false;
            }

            successMessage.textContent='Book inserted successfully!';

            return true;
        }

        function isNumber(price) {
            return typeof price === 'number';
        }

    </script>
</html>
